#!/bin/sh
# Pre-commit hook: Run lint, type check, tests, and coverage checks before committing

echo "ğŸ” Running pre-commit checks..."
echo ""

# 1. Run lint
echo "ğŸ“ Running lint..."
pnpm lint
if [ $? -ne 0 ]; then
  echo "âŒ Lint failed. Please fix linting errors before committing."
  exit 1
fi
echo "âœ… Lint passed"
echo ""

# 2. Run type check
echo "ğŸ” Running type check..."
pnpm check:type
if [ $? -ne 0 ]; then
  echo "âŒ Type check failed. Please fix type errors before committing."
  exit 1
fi
echo "âœ… Type check passed"
echo ""

# 3. Run all tests
echo "ğŸ§ª Running tests..."
pnpm test:run
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed. Please fix failing tests before committing."
  exit 1
fi
echo "âœ… Tests passed"
echo ""

# 4. Check handler test coverage
echo "ğŸ“Š Checking test coverage..."
pnpm test:check-coverage
if [ $? -ne 0 ]; then
  echo "âŒ Test coverage check failed. Please add missing tests before committing."
  exit 1
fi
echo "âœ… Test coverage check passed"
echo ""

echo "ğŸ‰ All pre-commit checks passed!"
